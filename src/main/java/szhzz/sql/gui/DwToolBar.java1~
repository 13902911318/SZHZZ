package sql.gui;


import sql.database.DBException;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.awt.Dimension;
import java.util.Vector;


/**
 * Created by Jhon.
 * User: szhzz
 * Date: 2006-10-3
 * Time: 22:38:56
 * To change this template use File | Settings | File Templates.
 */
public class DwToolBar extends JToolBar {
    public static final int B_RETRIEVE = 1;
    public static final int B_UPDATE = 2;
    public static final int B_FIRST = 3;
    public static final int B_PREVIOUS = 4;
    public static final int B_NEXT = 5;
    public static final int B_TAIL = 6;
    public static final int B_DELETE = 7;
    public static final int B_ADD = 8;


    DataWindow dw;
    Vector Events = new Vector();

    ImageIcon imageTB1 = new ImageIcon(DwToolBar.class.getResource("tb1.png"));
    ImageIcon imageTB2 = new ImageIcon(DwToolBar.class.getResource("tb2.png"));
    ImageIcon imageTB3 = new ImageIcon(DwToolBar.class.getResource("tb3.png"));
    ImageIcon imageTB4 = new ImageIcon(DwToolBar.class.getResource("tb4.png"));
    ImageIcon imageTB5 = new ImageIcon(DwToolBar.class.getResource("tb5.png"));
    ImageIcon imageTB6 = new ImageIcon(DwToolBar.class.getResource("tb6.png"));
    ImageIcon imageTB7 = new ImageIcon(DwToolBar.class.getResource("tb7.png"));
    ImageIcon imageTB8 = new ImageIcon(DwToolBar.class.getResource("tb8.png"));


    JButton jButton_Last = new JButton();
    JButton jButton_Next = new JButton();
    JButton jButton_Tail = new JButton();
    JTextField jTextField_gotoRow = new JTextField();
    JButton jButton_Add = new JButton();
    JButton jButton_Delet = new JButton();
    JButton jButtonRtrieve = new JButton();
    JButton jButton_Update = new JButton();
    JButton jButton_First = new JButton();

    public void setEnableAll(boolean onof){
        jButton_Last.setEnabled(onof);
        jButton_Next.setEnabled(onof);
        jButton_Tail.setEnabled(onof);
        jTextField_gotoRow.setEnabled(onof);
        jButton_Add.setEnabled(onof);
        jButton_Delet.setEnabled(onof);
        jButtonRtrieve.setEnabled(onof);
        jButton_Update.setEnabled(onof);
        jButton_First.setEnabled(onof);
    }

    public DwToolBar() {
        super();
        try {
            jbInit();
        } catch (Exception exception) {
            exception.printStackTrace();
        }

    }

    public void jbInit() throws Exception {
        //this.addSeparator();
        add(jButtonRtrieve);
        add(jButton_First);
        add(jButton_Last);
        add(jTextField_gotoRow);
        add(jButton_Next);
        add(jButton_Tail);
        add(jButton_Add);
        add(jButton_Delet);
        add(jButton_Update);

        jButton_Last.setToolTipText("Scoll Up");
        jButton_Last.setIcon(imageTB2);

        jButton_Next.setToolTipText("Scoll Down");
        jButton_Next.setIcon(imageTB3);

        jButton_Tail.setToolTipText("Scoll to Last");
        jButton_Tail.setIcon(imageTB4);

        jTextField_gotoRow.setMaximumSize(new Dimension(120, 20));
        jTextField_gotoRow.setMinimumSize(new Dimension(30, 20));
        jTextField_gotoRow.setPreferredSize(new Dimension(120, 20));
        jTextField_gotoRow.setToolTipText("Quick goto currentRow number");
        jTextField_gotoRow.setSelectionEnd(100);
        jTextField_gotoRow.setText("0");
        jTextField_gotoRow.setHorizontalAlignment(SwingConstants.CENTER);

        jButton_Add.setToolTipText("Append New Row");
        jButton_Add.setIcon(imageTB6);

        jButton_Delet.setToolTipText("Delete Selected Row");
        jButton_Delet.setIcon(imageTB5);

        jButtonRtrieve.setToolTipText("Retrieve");
        jButtonRtrieve.setIcon(imageTB7);

        jButton_Update.setToolTipText("Save");
        jButton_Update.setIcon(imageTB8);

        jButton_First.setToolTipText("Scoll to first rowe");
        jButton_First.setIcon(imageTB1);
    }

    public DataWindow getDataWindow() {
        return dw;
    }

    public void addEvent(DwToobar_Event event){
        Events.add(event);
    }

    boolean triggerEvent(int key){
        for(int i = 0 ; i < Events.size(); i++){
            DwToobar_Event dte = (DwToobar_Event) Events.get(i);
            if (! dte.toolbarClicked(key, this, null)) return false;
        }
        return true;
    }

    public void setDataWindow(DataWindow dw) {
        this.dw = dw;
        jButton_Last.addActionListener(new dwToolBar_jButton_Last_actionAdapter(this));
        jButton_Next.addActionListener(new dwToolBar_jButton_Next_actionAdapter(this));
        jButton_Tail.addActionListener(new dwToolBar_jButton_Tail_actionAdapter(this));
        jTextField_gotoRow.addFocusListener(new dwToolBar_jTextField_gotoRow_focusAdapter(this));
        jTextField_gotoRow.addActionListener(new dwToolBar_jTextField_gotoRow_actionAdapter(this));
        jButton_Add.addActionListener(new dwToolBar_jButton_Add_actionAdapter(this));
        jButton_Delet.addActionListener(new dwToolBar_jButton_Delet_actionAdapter(this));
        jButtonRtrieve.addActionListener(new dwToolBar_jButtonRtrieve_actionAdapter(this));
        jButton_Update.addActionListener(new dwToolBar_jButton_Update_actionAdapter(this));
        jButton_First.addActionListener(new dwToolBar_jButton_First_actionAdapter(this));
        dw.addsRowChangedListener(new Rowchanged_());
    }


    public void setCanSave(boolean canSave) {
        jButton_Update.setVisible(canSave);
    }

    public void setCanRetrieve(boolean can) {
        jButtonRtrieve.setVisible(can);
    }

    public void setCanAdd(boolean canAdd) {
        jButton_Add.setVisible(canAdd);
    }

    public void setCanDele(boolean canDele) {
        jButton_Delet.setVisible(canDele);
    }

    public void triggerRetrive(ActionEvent e) {
        if (! triggerEvent(B_RETRIEVE)) return;
        try {
            dw.retrive();
        } catch (DBException ex) {
            //TODO Unmark
            //loger.getLoger().showError(ex);
        }
    }

    public void trigger_Update(ActionEvent e) {
        //if (dw.isDataWindowReadOnly()) return;
        if (! triggerEvent(B_UPDATE)) return;
        try {
            dw.update();
        } catch (DBException ex) {
            //TODO Unmark
//            loger.getLoger().showError(ex);
        }
    }

    public void trigger_FirstRow(ActionEvent e) {
        if (! triggerEvent(B_FIRST)) return;
        // Cancel Editor if editting
        dw.removeEditor();
        dw.scrollToRow(0);
    }

    public void trigger_DeletRow(ActionEvent e) {
         if (! triggerEvent(B_DELETE)) return;
        int confirm = 0;

        //if (dw.isDataWindowReadOnly()) return;

        // Cancel Editor if editting
        dw.removeEditor();

        int row = dw.getSelectedRow();

        if (row == -1) {
            //TODO Unmark
//            loger.getLoger().messgeBox("Note","No currentRow selected for delete.");
        } else {
            try {
                if (dw.isNewRow(row) ) {  // && ! dw.isModified(currentRow)
                    dw.deleteRow(row);
                } else {
                    confirm = JOptionPane.showConfirmDialog(null,
                            "Delete the selected Row " + (row + 1) + " ?");
                    if (confirm == JOptionPane.YES_OPTION) {
                        dw.deleteRow(row);
                    }
                }
                if (row > 0)
                    row -= 1;
                else
                    row = 0;

                dw.scrollToRow(row);
            } catch (DBException ex) {
                //TODO Unmark
//                loger.getLoger().showError(ex);
            }
        }
    }

    public void trigger_AddRow(ActionEvent e) {
                if (! triggerEvent(B_ADD)) return;
        // Cancel Editor if editting
        dw.removeEditor();
        dw.appendRow();
        dw.scrollToRow(dw.getRowCount() - 1);
    }

    public void trigger_LastRow(ActionEvent e) {
                if (! triggerEvent(B_NEXT)) return;
        // Cancel Editor if editting
        dw.removeEditor();
        dw.scrollToRow(dw.getRowCount() - 1);
    }

    public void trigger_PreRow(ActionEvent e) {
                if (! triggerEvent(B_PREVIOUS)) return;
        if (dw.getSelectedRow() > 0){
            // Cancel Editor if editting
            dw.removeEditor();
            dw.scrollToRow(dw.getSelectedRow() - 1);
        }
    }

    public void trigger_NextRow(ActionEvent e) {
        if (! triggerEvent(B_NEXT)) return;
        if (dw.getSelectedRow() + 1 < (dw.getRowCount())){
            // Cancel Editor if editting
            dw.removeEditor();
            dw.scrollToRow(dw.getSelectedRow() + 1);
        }
    }

    public void trigger_gotoRow(ActionEvent e) {
        try {
            int r = (new Integer(jTextField_gotoRow.getText())).intValue() - 1;
            if (r >= 0 && r < dw.getRowCount() - 1){
                // Cancel Editor if editting
                dw.removeEditor();
                dw.scrollToRow(r);
            }
        } catch (Exception ex) {
            return;
        }
    }

    public void gotoRow_focusGained(FocusEvent e) {
        jTextField_gotoRow.selectAll();
    }

    //public void addsRowChangedListener(Rowchanged RowChangedListener)

    class Rowchanged_ extends DWRowChanged {
        public Rowchanged_() {
            debugId = "DwToolBar.Rowchanged";
        }

        public void rowChanged(int currentRow, int rowCount) {
            if (currentRow >= 0) jTextField_gotoRow.setText("Row " + (currentRow + 1) + "/" + rowCount);
        }
    }

//// Listeners class
//

    class dwToolBar_jTextField_gotoRow_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jTextField_gotoRow_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_gotoRow(e);
        }
    }


    class dwToolBar_jTextField_gotoRow_focusAdapter extends FocusAdapter {
        private DwToolBar adaptee;

        dwToolBar_jTextField_gotoRow_focusAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void focusGained(FocusEvent e) {
            adaptee.gotoRow_focusGained(e);
        }
    }


    class dwToolBar_jButton_Next_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Next_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_NextRow(e);
        }
    }


    class dwToolBar_jButton_Last_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Last_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_PreRow(e);
        }
    }


    class dwToolBar_jButton_Tail_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Tail_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_LastRow(e);
        }
    }


    class dwToolBar_jButton_Delet_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Delet_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_DeletRow(e);
        }
    }


    class dwToolBar_jButton_Update_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Update_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_Update(e);
        }
    }


    class dwToolBar_jButton_Add_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_Add_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_AddRow(e);
        }
    }


    class dwToolBar_jButton_First_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButton_First_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.trigger_FirstRow(e);
        }
    }


    class dwToolBar_jButtonRtrieve_actionAdapter implements ActionListener {
        private DwToolBar adaptee;

        dwToolBar_jButtonRtrieve_actionAdapter(DwToolBar adaptee) {
            this.adaptee = adaptee;
        }

        public void actionPerformed(ActionEvent e) {
            adaptee.triggerRetrive(e);
        }
    }
}

